# 2026-02-06 작업 로그

## 세션 1: 데미지 계산 수정 및 기능 추가

### 1. WekBonusDmgPerHit 구현
- `DamageCalculator.cs`에서 `WekBonusDmgPerHit` 로직 추가 (CriBonusDmgPerHit과 동일 방식)
- 여포 혈풍벽파/적토질풍격에 적용

### 2. FoolhardyBravery (용이무모) 버프 추가
- 여포 패시브 파티버프: `FoolhardyBravery = 31`
- BuffSet에 별도 필드로 추가 (Atk_Rate와 다른 버프명이므로 MaxMerge 독립)
- Add, MaxMerge, Clone, Clear, implicit operator 모두 반영
- StatCalculator에서 공격력 계산 시 Atk_Rate와 합산

### 3. MarkAttack (표식 공격) 모델 생성
- 여포 패시브 "방천화극의 분노" 구현
- MarkAttack 클래스: MaxStacks, AtkCount, Ratio, TargetMaxHpRatio
- CalcMarkDamage 메서드 추가 (CalcCoopDamage 패턴)
- 스킬 결과에 표식 데미지 출력

### 4. 버프 적용 방식 수정 (곱연산 → 합연산)
- StatCalculator: 공/방/체 버프 적용을 곱연산에서 합연산으로 변경
- 변경 전: `(1 + permanent%) × (1 + (timed+pet)%)`
- 변경 후: `1 + (permanent + timed + pet)%`
- 공격력계산식.xlsx와 대조하여 검증 완료

### 5. ExtraDmgMultiplier 수정
- 조건부 추가피해에 n인기피증 적용되도록 변경
- ExtraDmgMultiplier = multiplier (전체 피증 계수와 동일)

### 6. 에스파다 데미지 오차 수정 (Mark_Purify 자버프 타입피증 인식)
- 문제: GetSelfBuffTypeDmg가 Dmg_Dealt_Type만 체크, Mark_Purify 미포함
- 에스파다 마력정화(Mark_Purify=40)가 자버프 타입피증으로 인식 안 됨
- 스택소모 스킬의 SkillDmgMultiplier 분리가 작동하지 않아 스킬피해 과다 계산
- 수정: GetSelfBuffTypeDmg에 Mark_Energeia, Mark_Purify 추가
- 결과: 2,841,078 → 2,733,822 (인게임 2,733,907, 오차 0.003%)

### 7. UI 버프 리스트에 캐릭터 추가
- 여포: 패시브(용이무모), 혈풍벽파(방관@6초), 혈풍벽파(방깎@2초)
- 소교: 호접지몽(공증,치피@6초), 호접지몽(취약)
- 빅토리아: 패시브(댐감@2초), 사기 진작(공증), 권총 사격(취약)

### 8. 셋팅 비교 UI 간소화
- 1번/2번 셋팅 차이 비교(차이값, 퍼센트, 더 높음 표시) 제거
- 두 셋팅의 데미지 결과만 나란히 표시

## 📋 오늘 작업 요약
- 여포 캐릭터 패시브 시스템 완성 (FoolhardyBravery, MarkAttack, WekBonusDmgPerHit)
- 버프 합연산 방식 수정으로 공격력 계산 정확도 개선
- 에스파다 Mark_Purify 자버프 타입피증 인식 버그 수정 (오차 3.9% → 0.003%)
- n인기피증이 조건부 추가피해에 적용되도록 수정
- UI 버프 리스트에 소교/빅토리아/여포 추가
- 셋팅 비교 출력 간소화
