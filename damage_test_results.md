# 데미지 계산 테스트 결과 (2026-01-29)

## 요약

| 케이스 | 캐릭터 | 계산기 | 인게임 | 차이 | 결과 |
|--------|--------|--------|--------|------|------|
| 1 | 타카 (기준) | 43,776 | 44,478 | 1.6% | ✅ |
| 2 | 파스칼 (풀버프) | 156,660 | 145,491 | 7.7% 과다 | ❌ |
| 3 | 파스칼 (미호 제거) | 111,668 | 104,467 | 6.9% 과다 | ❌ |
| 4 | 파스칼 (취약 제거) | 74,491 | 71,825 | 3.7% 과다 | ❌ |
| 5 | 루리 (약점 발동) | 18,319 | 16,554 | 10.7% 과다 | ❌ |
| 6 | 루리 (약점 미발동) | 5,016 | 7,112 | 29.5% 부족 | ❌ |

---

## 케이스 1: 타카 - 죽음의 무도 (기준 테스트) ✅

### 설정
- **캐릭터**: 타카, 초월 10, 스강 O
- **스킬**: 죽음의 무도 (170%, 방무 40%)
- **보스**: 방어력 3,906, 방증 40%, 방깎 24%

### 스탯
| 항목 | 값 |
|------|-----|
| 공격력 | 7,111 |
| 치피 | 252% |
| 약피 | 130% |
| 피증 | 30% (복수자 4세트) |
| 보피증 | 80% (세트 40% + 버프 40%) |
| 인기피증 | 0% |
| 취약 | 0% |

### 계산 로그
```
스킬배율: 170% = 1.70x
방무: 40%
실효방어: 1,585.84, 방어계수: 4.7226
치명계수: 2.52x
약점계수: 1.30x
피증계수: 1.30 × 1.80 × 1.00 = 2.34x (곱연산)
```

### 결과
| 구분 | 값 |
|------|-----|
| **계산기** | 43,776 |
| **인게임** | 44,478 |
| **차이** | **1.6%** ✅ |

---

## 케이스 2: 파스칼 - 파괴의 거인 (풀버프) ❌

### 설정
- **캐릭터**: 파스칼, 초월 12, 스강 O
- **스킬**: 파괴의 거인 (470%, 방무 65%)
- **보스**: 방어력 3,906, 방증 40%, 방깎 24%

### 스탯
| 항목 | 값 |
|------|-----|
| 공격력 | 9,497 |
| 치피 | 358% (기본 150% + 초월 24% + 장비 144% + 패시브 40%) |
| 약피 | 153% (기본 130% + 미호 23%) |
| 피증 | 30% |
| 보피증 | 80% (세트 40% + 버프 40%) |
| 인기피증 | 6% (장신구) |
| 취약 | 22% |

### 계산 로그
```
[8] 피증계수 계산 (곱연산):
    기본피증: 30%
    타입피증: 0%
    조건부: 0%
    → 기본계수: 1.3000x
    보스피증: 80%
    → 보스계수: 1.8000x
    1인기피증: 6%
    → 인기계수: 1.0600x
    ★ 피증계수: 1.3000 × 1.8000 × 1.0600 = 2.4804x

[10] 기본데미지: 공9,497 / 방계수4.7226 = 2,010.96
    공격력피해: 2,010.96 × 4.7000 = 9,451.51
    × 치명3.5800 × 약점1.5300 × 피증2.4804
    = 기본데미지: 128,410

[17] 최종계산:
    취약계수: 1 + (22 + 0 + 0)/100 = 1.2200x
    ★ 최종: 156,660
```

### 결과
| 구분 | 값 |
|------|-----|
| **계산기** | 156,660 |
| **인게임** | 145,491 |
| **차이** | **7.7% 과다** ❌ |

---

## 케이스 3: 파스칼 - 미호 약피 버프 제거 ❌

### 변경점
- 약피: 153% → 130% (미호 패시브 23% 제거)
- 취약: 22% → 20% (윈디 펫만)

### 스탯
| 항목 | 값 |
|------|-----|
| 공격력 | 8,100 |
| 치피 | 358% |
| 약피 | 130% |
| 피증 | 30% |
| 보피증 | 80% |
| 인기피증 | 6% |
| 취약 | 20% |

### 계산 로그
```
[7] 약점계수: 발동 → 130% = 1.3000x
[8] 피증계수: 2.4804x

[10] 기본데미지: 공8,100 / 방계수4.7226 = 1,715.15
    = 기본데미지: 109,521

[17] 취약계수: 1.2000x
    ★ 최종: 131,425
```

### 결과
| 구분 | 값 |
|------|-----|
| **계산기** | 131,425 |
| **인게임** | 122,950 |
| **차이** | **6.9% 과다** ❌ |

---

## 케이스 4: 파스칼 - 취약/인기피증 모두 제거 ❌

### 변경점
- 취약: 20% → 0% (윈디 펫 스킬 제거)
- 인기피증: 6% → 0% (장신구 변경)
- 공격력: 윈디 펫 공버프 10% 제거로 감소

### 스탯
| 항목 | 값 |
|------|-----|
| 공격력 | 6,873 |
| 치피 | 358% |
| 약피 | 130% |
| 피증 | 30% |
| 보피증 | 80% |
| 인기피증 | 0% |
| 취약 | 0% |

### 계산 로그
```
[8] 피증계수 계산 (곱연산):
    → 기본계수: 1.3000x
    → 보스계수: 1.8000x
    → 인기계수: 1.0000x
    ★ 피증계수: 2.3400x

[10] 기본데미지: 공6,873 / 방계수4.7226 = 1,455.34
    = 기본데미지: 74,491

[17] 취약계수: 1.0000x
    ★ 최종: 74,491
```

### 결과
| 구분 | 값 |
|------|-----|
| **계산기** | 74,491 |
| **인게임** | 71,825 |
| **차이** | **3.7% 과다** ❌ |

---

## 케이스 5: 루리 - 폭격 지원 (약점 발동) ❌

### 설정
- **캐릭터**: 루리, 초월 8, 스강 O
- **스킬**: 폭격 지원 (170%, 방무 40%, 약추 155%)
- **보스**: 방어력 3,906, 방증 40%, 방깎 24%

### 스탯
| 항목 | 값 |
|------|-----|
| 공격력 | 5,648 |
| 치피 | 198% |
| 약피 | 130% |
| 피증 | 30% |
| 보피증 | 80% |
| 타입피증 | 29% (패시브 자버프) |
| 인기피증 | 0% |
| 취약 | 0% |

### 계산 로그
```
[6] 치명계수: 발동 → 1.9800x
[7] 약점계수: 발동 → 130% = 1.3000x

[8] 피증계수 계산 (곱연산):
    기본피증: 30%
    타입피증: 29%
    → 기본계수: (1 + (59 - 0)/100) = 1.5900x
    보스피증: 80%
    → 보스계수: 1.8000x
    ★ 피증계수: 2.8620x

[10] 기본데미지: 공5,648 / 방계수7.3816 = 765.14
    = 기본데미지: 9,582

[11] 추가피해:
    약점추가: 8,737

[14] 1타당합계: 기본9,582 + 약추8,737 = 18,319

[17] ★ 최종: 18,319
```

### 결과
| 구분 | 값 |
|------|-----|
| **계산기** | 18,319 |
| **인게임** | 16,554 |
| **차이** | **10.7% 과다** ❌ |

---

## 케이스 6: 루리 - 폭격 지원 (약점 미발동) ❌

### 변경점
- 약점: 미발동 (비스킷 버프 제거)
- 보피증: 80% → 40% (비스킷 보피증 40% 제거)

### 스탯
| 항목 | 값 |
|------|-----|
| 공격력 | 5,623 |
| 치피 | 174% |
| 약피 | 130% |
| 피증 | 30% |
| 보피증 | 40% |
| 타입피증 | 29% |
| 인기피증 | 0% |
| 취약 | 0% |

### 계산 로그
```
[6] 치명계수: 발동 → 1.7400x
[7] 약점계수: 미발동 → 1.0000x

[8] 피증계수 계산 (곱연산):
    → 기본계수: 1.5900x
    보스피증: 40%
    → 보스계수: 1.4000x
    ★ 피증계수: 2.2260x

[10] 기본데미지: 공5,623 / 방계수7.3816 = 761.76
    공격력피해: 761.76 × 1.7000 = 1,294.98
    × 치명1.7400 × 약점1.0000 × 피증2.2260
    = 기본데미지: 5,016

[11] 추가피해:
    (약점 미발동으로 약추 155% 없음)

[17] ★ 최종: 5,016
```

### 결과
| 구분 | 값 |
|------|-----|
| **계산기** | 5,016 |
| **인게임** | 7,112 |
| **차이** | **29.5% 부족** ❌ |

---

## 분석 및 의문점

### 1. 타카만 맞는 이유?
- 타카: 타입피증 0%, 인기피증 0%
- 파스칼/루리: 타입피증 또는 인기피증 있음

### 2. 피증 계산 방식 의심
현재 구현:
```
피증계수 = (1 + 기본피증 + 타입피증) × (1 + 보피증) × (1 + 인기피증)
```

의심되는 방식:
- 타입피증이 별도 곱연산?
- 또는 다른 계산 순서?

### 3. 루리 케이스 6 특이점
- 약점 미발동인데 인게임이 **더 높음** (42% 차이)
- 약점 관련 로직에 문제가 있을 수 있음

### 4. 추가 테스트 필요
- 타입피증 0%인 캐릭터로 테스트
- 피증/보피증/타입피증 각각 분리 테스트
- 약점 발동/미발동 시 계산 방식 확인

---

## 수정 이력

### 완료된 수정
1. **피증 곱연산** (DamageCalculator.cs)
   - 기존: `1 + (피증 + 보피증 + 인기피증) / 100`
   - 수정: `(1 + 기본피증) × (1 + 보피증) × (1 + 인기피증)`
   - 결과: 타카 테스트 통과 (1.6% 오차)

2. **디버그 로그 중복 제거**
   - `Debug.WriteLine` 제거, `Console.WriteLine`만 유지
   - UTF-8 인코딩 설정 추가

### 남은 문제
- 파스칼, 루리 등 타입피증이 있는 캐릭터에서 오차 발생
- 루리 약점 미발동 시 계산기가 크게 부족


치명타 o, 약점 x
키리엘 x
데이지 턴제 버프 o
══════════ 스탯 출처별 상세 ══════════
캐릭터: 파스칼, 초월: 12, 스강: True
세트: 복수자 4세트

[피증% 출처]
  캐릭터 기본: 0%
  초월: 0%
  세트: 30%
  장신구: 0%
  버프: 0%
  패시브 자버프: 0%
  ★ 합계: 30%

[보피증% 출처]
  캐릭터 기본: 0%
  초월: 0%
  세트: 40%
  장신구: 0%
  버프: 0%
  패시브 자버프: 0%
  ★ 합계: 40%

[타입피증% 출처]
  캐릭터 기본: 0%
  초월: 0%
  세트: 0%
  장신구: 0%
  버프: 0%
  패시브 자버프: 0%
  ★ 합계: 0%

[1-3인기% 출처]
  캐릭터 기본: 0%
  초월: 0%
  세트: 0%
  장신구: 6%
  버프: 0%
  패시브 자버프: 0%
  ★ 합계: 6%

[4-5인기% 출처]
  캐릭터 기본: 0%
  초월: 0%
  세트: 0%
  장신구: 0%
  버프: 0%
  패시브 자버프: 0%
  ★ 합계: 0%

[방무% 출처]
  캐릭터 기본: 0%
  초월: 0%
  세트: 0%
  버프: 0%
  패시브 자버프: 0%
  ★ 합계: 0%

[치피% 출처]
  캐릭터 기본: 150%
  초월: 24%
  세트: 0%
  장비 메인: 72%
  장비 부옵: 72%
  장신구: 0%
  버프: 0%
  패시브 자버프: 40%
  ★ 합계: 358%

[약피% 출처]
  캐릭터 기본: 130%
  초월: 0%
  세트: 0%
  버프: 0%
  패시브 자버프: 0%
  ★ 합계: 130%

══════════ 데미지 계산 디버그 ══════════
[입력] 캐릭터: 파스칼, 스킬: 파괴의 거인
[입력] 스강: True, 초월: 12

[2] PreCast 후 공격력: 8,753, 타수: 1
[3] 스킬배율: 470% = 4.7000x
[4] 방무: 입력0% + 스킬65% = 65.00%
[5] 방어계수: 보스방0 × (1+0-24)% × (1-0.65)
    실효방어: 0.00, 방어계수: 1.0000
[6] 치명계수: 발동 → 입력358% + 스킬0% = 3.5800x
[7] 약점계수: 미발동 → 130% = 1.0000x

[8] 피증계수 계산 (곱연산):
    기본피증: 30%
    타입피증: 0%
    조건부: 0%
    → 기본계수: (1 + (30 - 0)/100) = 1.3000x
    보스피증: 40%
    → 보스계수: (1 + 40/100) = 1.4000x
    1인기피증: 6%
    → 인기계수: (1 + 6/100) = 1.0600x
    피감합계: 0% (보스0% + 인기0%)
    ★ 피증계수: 1.3000 × 1.4000 × 1.0600 = 1.9292x

[10] 기본데미지: 공8,753 / 방계수1.0000 = 8,753.00
    공격력피해: 8,753.00 × 4.7000 = 41,139.10
    원시합계: 41,139.10
    × 치명3.5800 × 약점1.0000 × 피증1.9292
    + 고정피해: 0
    = 기본데미지: 284,129

[11] 추가피해:

[12] HP비례:

[14] 1타당합계: 기본284,129 + 조건0 + 약추0 + 치추0 = 284,129

[17] 최종계산:
    취약계수: 1 + (0 + 0 + 0)/100 = 1.0000x
    스킬피해: 284,129 × 1타 = 284,129
    상태이상: 0, HP비례: 0, 스택소모: 0
    취약전합계: 284,129
    ★ 최종: 284,129
인게임 31